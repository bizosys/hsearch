
<!DOCTYPE HTML>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <title>HSearch - Analysis</title>
  <link rel="shortcut icon" href="images/favicon.gif">
  
  <link rel="stylesheet" href="css/slick-default-theme.css" type="text/css"/>

  <link rel="stylesheet" href="css/slick.grid.css" type="text/css"/>
  <link rel="stylesheet" href="css/slick.columnpicker.css" type="text/css"/>
  
  <link href="css/bootstrap.css" rel="stylesheet" type="text/css" />
  <link rel="stylesheet" href="css/hsearch.css" type="text/css"/>
  
  <style>
    .cell-title {
      font-weight: bold;
    }

    .cell-effort-driven {
      text-align: center;
    }

    .cell-selection {
      border-right-color: silver;
      border-right-style: solid;
      background: #f5f5f5;
      color: gray;
      text-align: right;
      font-size: 10px;
    }

    .slick-row.selected .cell-selection {
      background-color: transparent; /* show default selected row background */
    }
    #msgArea{
        color:rgb(241, 110, 110);
        font-family: 'Segoe UI', 'Open Sans', Verdana, Arial, Helvetica,sans-serif;
        font-weight: normal;
	}
    
    
  </style>
</head>
<body>
<div id="wrapper">
	<div class="navbar navbar-default navbar-fixed-top" data-role="navigation">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse"
					data-target=".navbar-collapse">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand logo-nav" href="http://www.hadoopsearch.net" target="_blank">
					<img height="50px" width="190px" src="images/hsearch-logo.png" />
				</a>
			</div>
			<div class="collapse navbar-collapse collapse">
				<ul class="nav navbar-nav navbar-right">
					<li style="background:none;padding-right: 5px;"><a href="https://github.com/bizosys?tab=repositories">Follow In GitHub</a></li>
				</ul>
			</div>
			<!-- /.navbar-collapse -->
		</div>
		<!-- /.container -->
	</div>
				
	<div class="container">
		<div class="row">
			<div class="col-md-12">
				<div class="tableContainer">
					<div class="tableHeader" style="height: 42px; min-height: 42px;line-height: 42px;padding: 0px">
						<span class="col-md-5">
							<input type="button" class="txtBtn blueBg" onclick="document.location.href = 'projects.html'" value="Home" />
							<input type="button" class="txtBtn blueBg" onclick="saveQuery();" value="Save Query" />
							<input type="button" class="txtBtn blueBg" onclick="getQueries();" id="getQueryBtn" value="Get Saved Queries" />
						</span>
						<span class="col-md-1" style="text-align: right;">
							Search
						</span>
						<span class="col-md-6" style="text-align: right;">
							<span id="msgArea"></span>
							<input type="button" class="txtBtn blueBg" style="text-decoration: none;" value="Refresh Cache" onclick="refresh();">
							<input type="button" onclick="goToByScroll('#divHelp');" class="txtBtn blueBg" value="Help" style="text-decoration: none;">
						</span>
					</div>
					<div class="tableContent" style="padding: 15px">
						<div class="col-md-3" style="padding: 0">
							<select id="partitionKeysSelect" name="partitionKeysSelect" class="form-control" style="display: inline-block;" onchange="onPartitionKeyChange();">
								<option>Select Your Dataset</option>
							</select>
						</div>
						<div class="col-md-8" style="padding: 0 4px">
							<input type="text" value="" name="searchText" id="searchText" placeholder="Enter your search parameters here" spellcheck="false" class="form-control"/>
						</div>
						<div class="col-md-1" style="padding: 0">
							<input type="button" id="search" name="search" value="Analyze" onclick="doSearch();" class="txtBtn greenBg" style="width: 100%;padding: 7px 0;"/>
						</div>
						<div class="col-md-12" style="margin: 2px 0"></div>
						<div class="col-md-3" style="padding: 0">
							<div class="tableContainer">
								<div class="tableHeader">
									Repeatable Fields
								</div>
								<div class="tableContent">
									<select id="tabFldsSelect" name="tabFldsSelect" style="-webkit-border-radius: 0;-moz-border-radius: 0;border-radius: 0; " class="form-control" onchange="onTabFldChange();">
										<option>Select Repeatable Field</option>
									</select>
									<div id="grdTabFlds" style="height:458px; width:100%">Tab Fields</div>
								</div>
							</div>
						</div>
						<div class="col-md-9" style="padding:0 0 0 4px">
							<div class="tableContainer">
								<div class="tableHeader">
									<span id="lblSearch">No search word yet. </span>
								</div>
								<div class="tableContent">
									<div id="grdResults" style="height:450px; width:100%;">Search Results</div>
								</div>
								<div id="pager"></div>
							</div>
						</div>

			<!-- Modal Queries-->
				<div class="modal fade" id="queriesDiv" tabindex="-1" data-role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				  <div class="modal-dialog" style="height: 90% !important;width:92% !important;overflow:auto;">
				    <div class="modal-content">
				      <div class="modal-header">
				        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				        <h4 class="modal-title">Your saved queries.</h4>
				      </div>
				      <div class="modal-body" id="queryContent" style="padding: 5px;">
				      </div>
				      <div class="modal-footer" style="text-align: center;">
						    <input type="button" value="Analyze" class="txtBtn greenBg" onclick="savedQuerySelected();" />
				      </div>
				    </div><!-- /.modal-content -->
				  </div><!-- /.modal-dialog -->
				</div><!-- /.modal -->
						
					<div id="divHelp" class="col-md-12" style="padding: 0">
						<div class="tableContainer">
							<div class="tableHeader">
								Search Help
							</div>
						<div class="tableContent">
							<div class="col-md-6" style="padding: 15px;">
								<div class="tableContent" style="border: 1px solid #cdcdcd;height: 250px;">
									<p class="tableHeader">HSearch Queries</p>
									<div style="padding: 10px;">
										<b>Exact Match :</b> sex:Male<br/>
										<b>Phrase Match :</b> city:"New york"<br/>
										<b>Not Match :</b> sex:!"Male"<br/>
										<b>In Match :</b> days:{"Monday","Sunday"}<br/>
										<b>Range Match :</b> age:[10 : 20]<br/>
										<br/>
										Eg : (sex:"Male" AND days:{"Monday","Sunday"} AND age:!18) OR (sex:"Female" and age:18)
									</div>
								</div>
							</div>
							<div class="col-md-6" style="padding: 15px;">
								<div class="tableContent" style="border: 1px solid #cdcdcd;height: 250px;">
									<p class="tableHeader">Sorting</p>
									<div style="padding: 10px;">
										Sorting can be done on multiple fields.<br/>
										<b>Sort Ascending :</b> ^sex<br/>
										<b>Sort Descending:</b> sex<br/><br/>
										Eg : For sorting on two fields namely sex first (descending order) and then age, we can give as :<br/>
										<b>sort(sex,^age)</b>	
									</div>
								</div>
							</div>
							<div class="col-md-6" style="padding: 15px;">
								<div class="tableContent" style="border: 1px solid #cdcdcd;height: 250px;">
									<p class="tableHeader">Facetting</p>
									<div style="padding: 10px;">
										To get facet and facet count for particular fields we can give a 
										comma separated list of fields to perform the facet.
									</div>
								</div>
							</div>
							<div class="col-md-6" style="padding: 15px;">
								<div class="tableContent" style="border: 1px solid #cdcdcd;height: 250px;">
									<p class="tableHeader">Pagination</p>
									<div style="padding: 10px;">
										Results pagination can be done by giving below two parameters : <br/>
										<b>offset :</b> The starting point for pagination.<br/>
										<b>pagesize :</b> The number of records in single page.(-1 is unlimited)
									</div>
								</div>
							</div>
						</div>
						<div style="clear: both;"></div>
					</div>
				</div>
					<div style="clear: both;"></div>
				</div>
			</div>
		</div>
		</div>
	</div>
</div>

<script src="js/lib/firebugx.js"></script>

<script src="js/lib/jquery-1.7.min.js"></script>
<script src="js/lib/jquery-ui-1.8.16.custom.min.js"></script>
<script src="js/lib/jquery.event.drag-2.2.js"></script>
<script src="js/bootstrap.js"></script>

<script src="js/slick.core.js"></script>
<script src="js/slick.formatters.js"></script>
<script src="js/slick.editors.js"></script>
<script src="js/plugins/slick.checkboxselectcolumn.js"></script>
<script src="js/plugins/slick.rowselectionmodel.js"></script>
<script src="js/slick.grid.js"></script>
<script src="js/slick.dataview.js"></script>
<script src="js/my.pager.js"></script>
<script src="js/slick.columnpicker.js"></script>

<script>

var PAGESIZE = 50;
var tabCountGrid;
var sortcol = null;
var sortdir = 1;
var projectName = "";
var selectFields = "";
var whereFilter = "";
var resultColumns = [];
var selectFields = "";
var documentUrlFldResponseText = "unknown";


var dataView;
var grid;
var pager;
var data = [];
var columns = [];
var options = {
    editable: false,
    enableAddRow: false,
    enableCellNavigation: false
};
var dateFormatter = function (row, cell, value, columnDef, dataContext) {
    return (value.getMonth()+1) + "/" + value.getDate() + "/" + value.getFullYear();
};

var loadingIndicator = null;

$(function () {
	defaultLoad();
	initSearch();
	setProjectName(projectName);
	setSelectFields(selectFields);
});

function setSort(column, dir) {
    sortcol = column;
    sortdir = dir;
}

function setSearch(str) {
   whereFilter = str;
}

function setProjectName(str) {
   projectName = str;
}

function setSelectFields(str) {
   selectFields = str;
}

function defaultLoad(){
	var queryString = window.location.href.split('?')[1];
	if(!queryString)
	{
		showMessage('Unknown project.');
		return;
	}
	var paramValueStrL = queryString.split('&');
	var paramValueL = [];
	for(var paramValue in paramValueStrL)
	{
		var keyValue = paramValueStrL[paramValue].split('=');
		var keyValueAbs = keyValue[1].split('#');
		paramValueL[keyValue[0]] = keyValueAbs[0];
	}
	
	projectName = paramValueL['project'];
	if(!projectName)
	{
		showMessage('Unknown project.');
		return;
	}
	//'process.xml?service=search&action=partitionkeys&project='+projectName,		
	// AJAX call to get partition keys
	var partitionKeysResponseJson = "[]";
	var xmlData = {
		service: "service",
		action: "partitionkeys",
		project: projectName
	};
	$.ajax({
		type: "POST",
		async: false,
		url: "process.xml",
		data: xmlData,
		cache:false,
		dataType: "text",
		success: function onSuccess(data){
			if(null != data)
				partitionKeysResponseJson = data;
			else
				showMessage("Error in getting partiotin keys");
		},
		error: function onError(data)
		{
			showMessage("Error in getting partiotin keys");
			return false;
		}
	});  
	var partitionKeysObj = eval(partitionKeysResponseJson);
	var partitionKeySelectElm = document.getElementById("partitionKeysSelect");
	var len = 0;
	var isFirst = true;
	for(var keyIndex in partitionKeysObj){
		len = partitionKeySelectElm.options.length;
		partitionKeySelectElm[len] = new Option(partitionKeysObj[keyIndex], keyIndex);
		if(isFirst){
			partitionKeySelectElm[len].selected = "selected";
			isFirst = false;
		}
	}

	var tabFldResponseJson = '[]';
	//'process.xml?service=search&action=tabflds&project=' + projectName,
	// AJAX call to  get tab flds
	xmlData = {
		service: "service",
		action: "tabflds",
		project: projectName
	};
	$.ajax({
		type: "POST",
		async: false,
		url: "process.xml",
		data: xmlData,
		cache:false,
		dataType: "text",
		success: function onSuccess(data){
			if(null != data)
				tabFldResponseJson = data;
		},
		error: function onError(data)
		{
			showMessage("Error in getting tab fields");
			return false;
		}
	});  
	
	var tabFldJsonObj = eval(tabFldResponseJson);
	var tabFlds = [];
	
	for(var index in tabFldJsonObj)
		tabFlds[index] = tabFldJsonObj[index].name;
	
	var tabFldsSelectElem = document.getElementById("tabFldsSelect");
	var data = [];
		
	len = 0;
	isFirst = true;

	tabFlds.sort();
	for(var tabIndex in tabFlds){
		len = tabFldsSelectElem.options.length;
		tabFldsSelectElem[len] = new Option(tabFlds[tabIndex], tabIndex);
		if(isFirst){
			tabFldsSelectElem[len].selected = "selected";
			isFirst = false;
		}
	}

	// AJAX Call to get display flds
	var displayFldsResponseJson = '[]';
	xmlData = {
		service: "service",
		action: "displayflds",
		project: projectName,
		mergeid: $("#partitionKeysSelect option:selected").text()
	};
	$.ajax({
		type: "POST",
		async: false,
		url: "process.xml",
		data: xmlData,
		cache:false,
		dataType: "text",
		success: function onSuccess(data){
			if(null != data)
				displayFldsResponseJson = data;
		},
		error: function onError(data)
		{
			showMessage("Error in getting display fields");
			return false;
		}
	});  

	var displayFldsObj = eval(displayFldsResponseJson);
	displayFldsObj.sort(compare);
	for(var index in displayFldsObj)
	{
		resultColumns.push(displayFldsObj[index].name);
		if(index > 0)
			selectFields = selectFields + ",";
		
		selectFields = selectFields + displayFldsObj[index].name;
	}
	
	// AJAX Call to get documenturl fld
	//'process.xml?service=search&action=documenturlfld&project='+projectName,
	documentUrlFldResponseText = 'unknown';
	xmlData = {
		service: "service",
		action: "documenturlfld",
		project: projectName
	};
	$.ajax({
		type: "POST",
		async: false,
		url: "process.xml",
		data: xmlData,
		cache:false,
		dataType: "text",
		success: function onSuccess(data){
			if(null != data)
				documentUrlFldResponseText = data;
		},
		error: function onError(data)
		{
			showMessage("Error in getting docuement url fields");
			return false;
		}
	});  
	
	fetchTabCount($("#tabFldsSelect option:selected").text());
}

//comparer sort fields
function compare(a,b) {
  if (a.name < b.name)
     return -1;
  if (a.name > b.name)
    return 1;
  return 0;
}
	
function onPartitionKeyChange()
{
	$('#tabFldsSelect option')[0].selected = true;
	$('#searchText').val('');
	onTabFldChange();
}

function onTabFldChange()
{	
	var selectedTabFld = $("#tabFldsSelect option:selected").text();
	fetchTabCount(selectedTabFld);
}

var lastSelectedRows = [];
function fetchTabCount(tabFld)
{
	
	// AJAX Call to fetch tab count
	var tabFldCountResponseJson = '[]';
	//
	xmlData = {
		service: "service",
		action: "tabcount",
		project: projectName,
		mergeid:  $("#partitionKeysSelect option:selected").text(),
		fld: tabFld,
		filter: $('#searchText').val().trim()
	};
	$.ajax({
		type: "POST",
		async: false,
		url: "process.xml",
		data: xmlData,
		cache:false,
		dataType: "text",
		success: function onSuccess(data){
			if(null != data)
				tabFldCountResponseJson = data;
		},
		error: function onError(data)
		{
			showMessage("Error in getting tab counts");
			return false;
		}
	}); 
	
	var tabFldCountJsonObj = eval(tabFldCountResponseJson);

	var checkboxSelector = new Slick.CheckboxSelectColumn({
	  cssClass: "slick-cell-checkboxsel"
	});
	
	var columns = [];
	columns.push(checkboxSelector.getColumnDefinition());
	columns.push({id: "name", name: "Name", field: "name", width: 150, sortable: true});
	columns.push({id: "count", name: "Count", field: "count", width: 70, sortable: true});
	
	var options = {
	    editable: false,
	    enableAddRow: false,
	    enableCellNavigation: false,
		forceFitColumns: true 
	};

	var data = [];
	for(var index in tabFldCountJsonObj)
	{
		var d = (data[index] = {});
		d["name"] = tabFldCountJsonObj[index].name;
		d["count"] = tabFldCountJsonObj[index].count;
	}
	tabCountGrid = new Slick.Grid("#grdTabFlds", data, columns, options);
	tabCountGrid.setSelectionModel(new Slick.RowSelectionModel({selectActiveRow: false}));
	tabCountGrid.onClick.subscribe( function (e){
		var selectedCell  = tabCountGrid.getCellFromEvent(e);
		if(selectedCell.cell > 0)
			return;
		
		if(!($(e.target)[0].className == ""))
            return;
		
		var selectedColumnVal = tabCountGrid.getData()[selectedCell.row].name;
		if (selectedColumnVal.indexOf(" ") > 0) selectedColumnVal = "\"" + selectedColumnVal + "\"";
		var selectedTabFld = $( "#tabFldsSelect option:selected").text();
		
		if(contains(lastSelectedRows, selectedColumnVal, true))
		{
			lastSelectedRows.pop(selectedColumnVal);
			var searchText = $('#searchText').val();
			searchText = searchText.replace( " AND " + selectedTabFld + ":" + selectedColumnVal, '');
			searchText = searchText.replace( " OR " + selectedTabFld + ":" + selectedColumnVal, '');
			searchText = searchText.replace(selectedTabFld + ":" + selectedColumnVal, '');
			
			if(searchText.substring(0, " AND" ) === " AND" )
					searchText = searchText.substring(" AND".length);
			else if(searchText.substring(0, " OR") === " OR" )
					searchText = searchText.substring(" OR".length);
			
			$('#searchText').val(searchText);
		}
		else
		{
			lastSelectedRows.push(selectedColumnVal);
			var searchText = $('#searchText').val();
			if(searchText.length > 0)
				searchText = searchText + " AND ";
				
			searchText = searchText + selectedTabFld + ":" + selectedColumnVal;
			$('#searchText').val(searchText);
		}
	});
	
	tabCountGrid.registerPlugin(checkboxSelector);	
	tabCountGrid.onSort.subscribe(function (e, args) {
	var field = args.sortCol.field;
	data.sort(function(a, b)
	{
        var result = 
            a[field] > b[field] ? 1 :
            a[field] < b[field] ? -1 :
            0;
        return args.sortAsc ? result : -result;
    });
	tabCountGrid.invalidate();    
  });
}

function doSearch() {
	var whereFilter = $('#searchText').val();
	var len = (null == whereFilter) ? 0 : whereFilter.trim().length;
	if(0 == len){
		alert("Please specify a search query.");
		return;
	}
		
	setSearch(whereFilter);
	fetchSearchData(0,PAGESIZE,0);
}

function fetchSearchData(offset, pagesize, pagenum){
	if ( projectName.length == 0 || selectFields.length == 0 ) {
		showMessage("Project is not set.");
		return;
	}
	loadingIndicator.show();
	var sortBy =  "";
	if (sortcol != null) {
		sortBy = ((sortdir > 0) ? "^" : "") + sortcol;
	}

	var xmlData = {
		service: "service",
		action: "search",
		project: projectName,
		mergeid: $("#partitionKeysSelect option:selected").text(),
		select: selectFields,
		filter: whereFilter,
		offset: offset,
		pagesize: pagesize,
		sort: sortBy
	};		

	$.ajax({
		type: "POST",
		async: false,
		url: "process.xml",
		data: xmlData,
		cache:false,
		dataType: "text",
		success: function onSuccess(responseData){
			if(null != responseData) {
				var searchResultsJsonObj = eval( '(' + responseData + ')');
								
				$("#lblSearch").html("Total results found " + searchResultsJsonObj.count + " in " + searchResultsJsonObj.time + " ms");
				if(searchResultsJsonObj.count == 0){
					showMessage('No matching records for given query');
					data = [];
					dataView.beginUpdate();
					dataView.setItems(data);
					dataView.endUpdate();
					loadingIndicator.hide();	
					return;
				}
				
				var records = searchResultsJsonObj.records;
				if( null == searchResultsJsonObj) data.length = 0;
				else data.length = Math.min(parseInt(searchResultsJsonObj.count),1000000); // limitation of the API 
				
				var resultColumnsLower = [];
				for(var columnI in resultColumns) {
					resultColumnsLower[columnI] = resultColumns[columnI].toLowerCase();
				}
				
				data = [];
				var to = (pagenum + 1) * PAGESIZE;
				var actualRecordsLen = records.length;
				for(var i = offset,j=0; i < to; i++,j++)
				{	
					if(j >= actualRecordsLen)
						break;
					var item = [];
					item['hsearchGridId'] = i;
					for(var columnI in resultColumns)
					{
						item[resultColumns[columnI]] = records[j][resultColumnsLower[columnI]];
					}
					data[j] = item;
				}
				var totalPages = Math.ceil(searchResultsJsonObj.count /PAGESIZE); 
				pager.setDefaultOptions({pageSize: PAGESIZE, pageNum: pagenum, totalRows: searchResultsJsonObj.count, totalPages: totalPages});
				
				dataView.beginUpdate();
				dataView.setItems(data,'hsearchGridId');
				dataView.endUpdate();
				var dataLen = data.length;
				for(var k = 0; k < dataLen; k++)
					grid.updateRow(k);
				loadingIndicator.hide();
				
			} else {
				loadingIndicator.hide();
				data.length = 0;
			}
		},
		error: function onError(data)
		{
			loadingIndicator.hide();
			showMessage("Search Error :" + data.responseText);
			return false;
		}
	});  
}

function initSearch(){
	//initalize loading indicator
	if (!loadingIndicator) {
		loadingIndicator = $("<span class='loading-indicator'><label>Loading...</label></span>").appendTo(document.body);
		var $g = $("#grdResults");

		loadingIndicator
			.css("position", "absolute")
			.css("display", "none")
			.css("top", $g.offset().top + (($g.height() - loadingIndicator.height()) / 2))
			.css("left", $g.offset().left + (($g.width() - loadingIndicator.width()) / 2));
	}

	for(var columnI in resultColumns)
	{
		columns.push({id: resultColumns[columnI], name: resultColumns[columnI], field: resultColumns[columnI], width: 150, sortable: true});
	}  
	
	dataView = new Slick.Data.DataView();
	grid = new Slick.Grid("#grdResults", dataView, columns, options);
	grid.setSelectionModel(new Slick.RowSelectionModel());
	pager = new Slick.Controls.Pager(dataView, $("#pager"), {pageSize: 0, pageNum: 0, totalRows: 0, totalPages: 0});
	
	grid.onSort.subscribe(function (e, args) {
        setSort(args.sortCol.field, args.sortAsc ? 1 : -1);
        var pagingInfo = pager.getDefaultOptions();
        var offset = pagingInfo.pageNum * pagingInfo.pageSize;
        fetchSearchData(offset, PAGESIZE, pagingInfo.pageNum);
        var rows = [];
        for(var i = 0; i < PAGESIZE; i++){
        	rows[i] = i;
        }
        grid.invalidateRows(rows);
        grid.updateRowCount();
        grid.render();
	});

	// wire up model events to drive the grid
	dataView.onRowCountChanged.subscribe(function (e, args) {
	    grid.updateRowCount();
	    grid.render();
	});

	dataView.onRowsChanged.subscribe(function (e, args) {
	    grid.invalidateRows(args.rows);
	    grid.render();
	});

	pager.onPaging.subscribe(function (e, pagingInfo) {
	    var offset = pagingInfo.pageNum * pagingInfo.pageSize;
	    fetchSearchData(offset, PAGESIZE, pagingInfo.pageNum);
	});
	  
	  // initialize the model after all the events have been hooked up
	  dataView.beginUpdate();
	  dataView.setItems(data,'hsearchGridId');
	  dataView.endUpdate();
	  dataView.syncGridSelection(grid, false);
}

function refresh()
{
	var xmlData = {
		service: "service",
		action: "refresh",
		project: projectName
	};
	$.ajax({
		type: "POST",
		async: false,
		url: "process.xml",
		data: xmlData,
		cache:false,
		dataType: "text",
		success: function onSuccess(data){
			showMessage("Successfully refreshed.");
		},
		error: function onError(data)
		{
			showMessage("Error in refreshing.");
			return false;
		}
	}); 
	
}

function saveQuery(){
	var query = $("#searchText").val();
	if(query == ""){
		alert("Please Write a query before saving.");
		return false;
	}
		
	
	var queryName = prompt("Please enter the name for your query :","");

	if (queryName == null)
		return false;
	
	var xmlData = {
			service: "service",
			action: "savequery",
			queryName: queryName,
			query: query,
			project: projectName
	};
	
		$.ajax({
			type: "POST",
			async: false,
			url: "process.xml",
			data: xmlData,
			cache:false,
			dataType: "text",
			success: function onSuccess(data){
				showMessage("Successfully saved your query.");
			},
			error: function onError(data)
			{
				showMessage("Error in saving your query please try later.");
				return false;
			}
		}); 
}

function getQueries(){
	
	var xmlData = {
			service: "service",
			action: "getqueries",
			project: projectName
	};
	
		$.ajax({
			type: "POST",
			async: false,
			url: "process.xml",
			data: xmlData,
			cache:false,
			dataType: "text",
			success: function onSuccess(data){
				var htmlSnippet = [];
				var xml = $.parseXML( data );
				var $queries = $(xml).find("query");
				var name ="";
				var val ="";
					
				$queries.each(function() {
                    name = $(this).find("name").text();
                    val = $(this).find("value").text();
                    htmlSnippet.push("<input type='radio' name='savedQuery' value='");

                    htmlSnippet.push(val);
                    htmlSnippet.push("'>");
                    htmlSnippet.push(name);
                    htmlSnippet.push("<br/>&nbsp;&nbsp;&nbsp;&nbsp;<i>");
                    htmlSnippet.push(val);
                    htmlSnippet.push("</i></input><br/>");

                    $("#queryContent").html(htmlSnippet.join(" "));
                    $("#queriesDiv").modal();
				});
			},
			error: function onError(data)
			{
				showMessage("Error in retrieving saved queries.");
				return false;
			}
		}); 		
}

function savedQuerySelected(){
	$("#queriesDiv").modal('hide');
	var query = $( "input:radio[name=savedQuery]:checked" ).val();
	$('#searchText').val(query);
	doSearch();	
}

function contains(array, elem, casesensitive)
{
	if(casesensitive){
		for(var e in array){
			if(array[e] === elem) return true;
		}
		
	}
	else{
		for(var e in array){
			if(array[e].toLowerCase() == elem.toLowerCase()) return true;
		}
	}
	return false;
}

function showMessage(msg) {
	$('#msgArea').html(msg);
	setTimeout(function(){clearMessage()},3000);
}

function clearMessage() {
	$('#msgArea').html("");
}

function showStatusPopUp(){
	$("#propertyWindowDiv").modal({
		minHeight: 550,
		minWidth: 370,
		onShow: function (dialog) {
		}
	});
}

function goToByScroll(id) {
	var pos = $(id).offset().top - 60;
	$('html,body').animate({
		scrollTop : pos
	}, 1000);
}


</script>
</body>
</html>
